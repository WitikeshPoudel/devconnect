<!DOCTYPE html>
<html>
<head>
  <title>DevConnect - Posts</title>
</head>
<body>

  <h1>Create Post</h1>

  <form id="postForm">
    <input type="text" id="username" placeholder="Enter username" required />
    <input type="text" id="content" placeholder="What's on your mind?" required />
    <button type="submit">Post</button>
  </form>

  <h2>All Posts</h2>
  <div id="postList"></div>

<script>
const form = document.getElementById("postForm");
const postList = document.getElementById("postList");

/* =========================
   LOAD POSTS
========================= */
async function loadPosts() {
  const response = await fetch("/posts");
  const posts = await response.json();

  postList.innerHTML = "";

  posts.forEach(post => {
    const div = document.createElement("div");
    div.style.border = "1px solid black";
    div.style.padding = "10px";
    div.style.marginBottom = "10px";

    div.innerHTML = `
      <strong>${post.username}</strong><br/>
      ${post.content}<br/>
      <small>${post.createdAt}</small><br/><br/>
      ❤️ Likes: ${post.likes}
      <button onclick="likePost('${post.id}')">Like</button>
      <button onclick="deletePost('${post.id}')">Delete</button>
      <button onclick="editPost('${post.id}', '${post.username}', '${post.content}')">Edit</button>
    `;

    postList.appendChild(div);
  });
}

/* =========================
   CREATE POST
========================= */
form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const username = document.getElementById("username").value;
  const content = document.getElementById("content").value;

  await fetch("/posts", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, content })
  });

  form.reset();
  loadPosts();
});

/* =========================
   DELETE POST
========================= */
async function deletePost(id) {
  await fetch(`/posts/${id}`, {
    method: "DELETE"
  });

  loadPosts();
}

/* =========================
   EDIT POST
========================= */
async function editPost(id, oldUsername, oldContent) {
  const newUsername = prompt("Edit username:", oldUsername);
  const newContent = prompt("Edit content:", oldContent);

  if (newUsername && newContent) {
    await fetch(`/posts/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: newUsername,
        content: newContent
      })
    });

    loadPosts();
  }
}

/* =========================
   LIKE POST
========================= */
async function likePost(id) {
  await fetch(`/posts/${id}/like`, {
    method: "PUT"
  });

  loadPosts();
}

/* =========================
   INITIAL LOAD
========================= */
loadPosts();

</script>

</body>
</html>